<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tabungan Neon Bank</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0a0f1c;
  --card:#111827;
  --accent:#10b981;
  --accent2:#34d399;
  --neon:#34d399;
  --redneon:#ef4444;
  --glass:rgba(255,255,255,0.04);
  --muted:rgba(255,255,255,0.6);
  --shadow:0 8px 32px rgba(0,0,0,0.4);
}
*{box-sizing:border-box;transition:0.2s ease}
body{
  font-family:Inter,system-ui;
  margin:0;padding:18px;
  background:linear-gradient(180deg,#020617,#0f172a 60%);
  color:#eef2ff;
  min-height:100vh;
}
.container{max-width:980px;margin:0 auto}
header{margin-bottom:18px;text-shadow:0 0 12px var(--neon);}
header h1{margin:0;font-size:24px;font-weight:800;color:var(--neon);text-align:center;}
.card{
  background:var(--card);
  border-radius:20px;
  padding:20px;
  box-shadow:var(--shadow);
  backdrop-filter: blur(12px);
  border:1px solid rgba(255,255,255,0.05);
}
.stat{
  background:var(--glass);
  border-radius:16px;
  padding:16px;
  min-width:180px;
  box-shadow:0 4px 20px rgba(0,0,0,0.3);
  text-align:center;
}
.stat .label{font-size:12px;color:var(--muted)}
.stat .value{font-size:22px;font-weight:700;color:var(--accent2);text-shadow:0 0 6px var(--accent2);}
form{display:flex;flex-wrap:wrap;gap:12px;margin-top:18px}
.input{
  background:rgba(255,255,255,0.08);
  border:1px solid rgba(255,255,255,0.08);
  border-radius:14px;
  padding:12px;
  color:white;
  flex:1;
}
.input:focus{
  border-color:var(--accent);
  box-shadow:0 0 12px var(--accent);
  outline:none;
}
.btn{
  padding:12px 18px;
  border-radius:14px;
  border:none;
  cursor:pointer;font-weight:600;
  transition:0.3s;
}
.btn-primary{
  background:linear-gradient(90deg,var(--accent),var(--accent2));
  color:#001b12;
  box-shadow:0 0 8px var(--neon),0 0 16px var(--neon);
}
.btn-primary:hover{
  filter:brightness(1.2);
  box-shadow:0 0 12px var(--neon),0 0 24px var(--neon);
}
.btn-red{
  background:var(--redneon);
  color:white;
  box-shadow:0 0 6px var(--redneon),0 0 12px var(--redneon);
}
.btn-red:hover{
  filter:brightness(1.15);
  box-shadow:0 0 12px var(--redneon),0 0 24px var(--redneon);
}
.table-wrap{
  margin-top:20px;
  border-radius:14px;
  overflow:auto;
  box-shadow:0 6px 28px rgba(0,0,0,0.35);
}
table{width:100%;min-width:780px;border-collapse:collapse}
thead{
  background:rgba(255,255,255,0.06);
  backdrop-filter:blur(6px);
}
th,td{padding:12px 14px;border-bottom:1px solid rgba(255,255,255,0.05);font-size:14px;}
th{color:var(--muted);font-size:12px;letter-spacing:0.5px;}
td.number{text-align:right;font-family:monospace;font-size:15px;}
tr:hover{background:rgba(255,255,255,0.04);}
.empty{text-align:center;padding:32px;color:var(--muted);}
footer{text-align:center;margin-top:16px;font-size:12px;color:var(--muted);}
@media(max-width:640px){
  .stat{min-width:46%}
  .input{flex:1 1 100%}
}
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>ğ“ğ€ğğ”ğğ†ğ€ğ ğğ€ğ’ğˆğŒğğğğ†</h1>
  </header>

<!-- TEKS BERJALAN -->
<div style="width:100%;overflow:hidden;background:rgba(0,0,0,0.1);border-radius:14px;margin-bottom:16px;">
  <div id="marquee" style="display:inline-block;white-space:nowrap;color:var(--accent2);font-weight:600;padding:8px 0;animation:marqueeAnim 15s linear infinite;">
    ğŒğ¢ğ¦ğ©ğ¢ ğ›ğğ¬ğšğ« ğğ¢ğ¦ğ®ğ¥ğšğ¢ ğğšğ«ğ¢ ğ­ğšğ›ğ®ğ§ğ ğšğ§ ğ¤ğğœğ¢ğ¥! &nbsp;&nbsp;ğŸ’° &nbsp;&nbsp;ğ“ğğ­ğšğ© ğ¬ğğ¦ğšğ§ğ ğšğ­ ğ²ğš ğ¬ğšğ²ğšğ§ğ ğ 
  </div>
</div>

<style>
@keyframes marqueeAnim{
  0%{transform:translateX(100%)}
  100%{transform:translateX(-100%)}
}
</style>

<div class="card" id="dashboard" style="display:none;">
  <div class="top-row" style="display:flex;gap:16px;flex-wrap:wrap;align-items:center;justify-content:center;margin-bottom:12px;">
    <div class="stat">
      <div class="label">ğ“ğğ“ğ€ğ‹ ğ’ğ€ğ‹ğƒğ</div>
      <div id="totalSaldo" class="value">Rp 0</div>
    </div>
    <div class="stat">
      <div class="label">ğ‰ğ®ğ¦ğ¥ğšğ¡ ğ“ğ«ğšğ§ğ¬ğšğ¤ğ¬ğ¢</div>
      <div id="countTx" class="value">0</div>
    </div>
  </div>

  <button id="hapusSemuaBtn" class="btn btn-red" type="button">ğ‡ğšğ©ğ®ğ¬ ğ’ğğ¦ğ®ğš ğƒğšğ­ğš</button>
  <button id="btnLogout" class="btn btn-red" style="float:right;margin-top:-48px;">ğ‹ğ¨ğ ğ¨ğ®ğ­</button>

  <form id="txForm" onsubmit="return false" style="margin-top:12px">
    <input id="tanggal" class="input" type="date" required />
    <input id="keterangan" class="input" type="text" placeholder="ğŠğğ­ğğ«ğšğ§ğ ğšğ§" />
    <input id="debit" class="input" type="number" placeholder="ğƒğğ›ğ¢ğ­ (ğ¤ğ®ğ«ğšğ§ğ ğ¢ ğ¬ğšğ¥ğğ¨)" step="0.01" min="0" />
    <input id="credit" class="input" type="number" placeholder="ğ‚ğ«ğğğ¢ğ­ (ğ­ğšğ¦ğ›ğšğ¡ ğ¬ğšğ¥ğğ¨)" step="0.01" min="0" />
    <button id="simpanBtn" class="btn btn-primary">ğ’ğ¢ğ¦ğ©ğšğ§</button>
    <button id="clearBtn" class="btn">ğğğ«ğ¬ğ¢ğ¡ğ¤ğšğ§</button>
  </form>

  <div class="table-wrap">
    <table aria-label="Tabel Transaksi" id="txTable">
      <thead>
        <tr>
          <th>ğğ¨</th>
          <th>ğ“ğšğ§ğ ğ ğšğ¥</th>
          <th>ğŠğğ­ğğ«ğšğ§ğ ğšğ§</th>
          <th class="number">ğƒğğ›ğ¢ğ­</th>
          <th class="number">ğ‚ğ«ğğğ¢ğ­</th>
          <th class="number">ğ“ğ¨ğ­ğšğ¥ ğ’ğšğ¥ğğ¨</th>
        </tr>
      </thead>
      <tbody id="tbody">
        <tr><td colspan="6" class="empty">Memuat data...</td></tr>
      </tbody>
    </table>
  </div>
</div>
</div>

<!-- LOGIN SCREEN -->
<div id="loginScreen" style="position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(180deg,#020617,#0f172a);display:flex;align-items:center;justify-content:center;z-index:99999;">
  <div style="background:#111827;padding:28px;border-radius:22px;box-shadow:0 12px 40px rgba(0,0,0,0.6);width:300px;text-align:center;border:1px solid rgba(255,255,255,0.06);">
    <h2 style="margin:0 0 10px 0;color:var(--neon);font-weight:800;">ğ’ğğ¥ğšğ¦ğšğ­ ğƒğšğ­ğšğ§ğ </h2>
    <input id="loginEmail" type="email" placeholder="Email" style="width:100%;padding:10px;border-radius:12px;margin-bottom:10px;border:1px solid rgba(255,255,255,0.08);background:#1e293b;color:white;">
    <input id="loginPass" type="password" placeholder="Password" style="width:100%;padding:10px;border-radius:12px;margin-bottom:14px;border:1px solid rgba(255,255,255,0.08);background:#1e293b;color:white;">
    <button id="btnLogin" class="btn btn-primary" style="width:100%;">ğ‹ğğ†ğˆğ</button>
    <button id="btnDaftar" class="btn" style="width:100%;margin-top:8px;border:1px solid var(--neon);color:var(--neon);">ğƒğ€ğ…ğ“ğ€ğ‘</button>
    <p id="loginError" style="color:var(--redneon);margin-top:10px;font-size:12px;display:none;">Login gagal!</p>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
// FIREBASE CONFIG
const firebaseConfig = {
  apiKey: "AIzaSyB4Dfjmed5eECTypyubd4WcwFJmjx0PHHA",
  authDomain: "pasimpong.firebaseapp.com",
  projectId: "pasimpong",
  storageBucket: "pasimpong.firebasestorage.app",
  messagingSenderId: "995552502696",
  appId: "1:995552502696:web:71c799f97f2e61b436339d",
  measurementId: "G-12JXFL8S28"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

let txRef = null;

// ELEMENTS
const loginScreen = document.getElementById('loginScreen');
const dashboard = document.getElementById('dashboard');
const loginEmail = document.getElementById('loginEmail');
const loginPass = document.getElementById('loginPass');
const loginError = document.getElementById('loginError');

const tanggalEl = document.getElementById('tanggal');
const debitEl = document.getElementById('debit');
const creditEl = document.getElementById('credit');
const keteranganEl = document.getElementById('keterangan');
const simpanBtn = document.getElementById('simpanBtn');
const clearBtn = document.getElementById('clearBtn');
const hapusSemuaBtn = document.getElementById('hapusSemuaBtn');
const totalSaldoEl = document.getElementById('totalSaldo');
const countTxEl = document.getElementById('countTx');
const tbody = document.getElementById('tbody');
const btnLogout = document.getElementById('btnLogout');

// FORMAT RUPIAH
function formatRupiah(num){return (Number(num)||0).toLocaleString('id-ID',{style:'currency',currency:'IDR',maximumFractionDigits:2});}

// LOGIN STATE
auth.onAuthStateChanged(user=>{
  if(user){
    loginScreen.style.display='none';
    dashboard.style.display='block';
    txRef = db.ref('transaksi/' + user.uid);

    txRef.on('value', snapshot=>{
      const val = snapshot.val()||{};
      const arr = [];
      for(const key in val) arr.push({key,...val[key]});
      arr.sort((a,b)=>a.createdAt-b.createdAt);

      if(arr.length===0){
        tbody.innerHTML='<tr><td colspan="6" class="empty">Belum ada transaksi</td></tr>';
        totalSaldoEl.textContent=formatRupiah(0);
        countTxEl.textContent='0';
        return;
      }

      let running=0;
      let rows='';
      arr.forEach((tx,idx)=>{
        running += (Number(tx.credit)||0) - (Number(tx.debit)||0);
        const dateStr = new Date(tx.tanggal).toLocaleDateString('id-ID');
        rows += `<tr data-key="${tx.key}">
          <td>${idx+1}</td>
          <td>${dateStr}</td>
          <td>${tx.keterangan||''}</td>
          <td class="number">${formatRupiah(tx.debit)}</td>
          <td class="number">${formatRupiah(tx.credit)}</td>
          <td class="number">${formatRupiah(running)}</td>
        </tr>`;
      });
      tbody.innerHTML=rows;
      totalSaldoEl.textContent=formatRupiah(running);
      countTxEl.textContent=arr.length;

      // Hapus per baris klik kanan
      document.querySelectorAll('tr[data-key]').forEach(tr=>{
        tr.addEventListener('contextmenu', e=>{
          e.preventDefault();
          const key=tr.getAttribute('data-key');
          if(confirm('Hapus transaksi ini?')) txRef.child(key).remove();
        });
      });
    });
  }else{
    loginScreen.style.display='flex';
    dashboard.style.display='none';
    txRef = null;
  }
});

// LOGIN / DAFTAR
document.getElementById('btnLogin').onclick=()=>{
  loginError.style.display='none';
  auth.signInWithEmailAndPassword(loginEmail.value,loginPass.value).catch(()=>loginError.style.display='block');
};
document.getElementById('btnDaftar').onclick=()=>{
  loginError.style.display='none';
  auth.createUserWithEmailAndPassword(loginEmail.value,loginPass.value).catch(()=>loginError.style.display='block');
};

// LOGOUT
btnLogout.onclick=()=>{auth.signOut();};

// SIMPAN TRANSAKSI
simpanBtn.onclick=async ()=>{
  if(!txRef) return alert('Harus login!');
  const tanggal = tanggalEl.value;
  const debit = Number(debitEl.value)||0;
  const credit = Number(creditEl.value)||0;
  const keterangan = keteranganEl.value.trim();
  if(!tanggal){alert('Pilih tanggal transaksi');return;}
  if(debit===0 && credit===0){alert('Isi debit atau credit');return;}
  await txRef.push({
    tanggal,
    debit:parseFloat(debit.toFixed(2)),
    credit:parseFloat(credit.toFixed(2)),
    keterangan,
    createdAt:Date.now()
  });
  tanggalEl.value=''; debitEl.value=''; creditEl.value=''; keteranganEl.value='';
};

// BERSIHKAN FORM
clearBtn.onclick=()=>{tanggalEl.value=''; debitEl.value=''; creditEl.value=''; keteranganEl.value='';};

// HAPUS SEMUA
hapusSemuaBtn.onclick=async ()=>{
  if(!txRef) return alert('Harus login!');
  if(confirm('Hapus SEMUA transaksi? TIDAK BISA DIBATALKAN')) await txRef.remove();
};

// Default tanggal hari ini
tanggalEl.valueAsDate = new Date();
</script>
</body>
</html>
